<!DOCTYPE html>
<html>

<head><meta charset="UTF-8">
<meta http-equiv="Cache-control" content="public">

<link rel="apple-touch-icon" sizes="180x180" href="https://thesecurityvault.com/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://thesecurityvault.com/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://thesecurityvault.com/favicon/favicon-16x16.png">
<link rel="manifest" href="https://thesecurityvault.com/site.webmanifest">

<title>The Log Forging Vulnerability And How To Fix It</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="description"
  content="Log forging vulnerability can be exploited to fake log entries, causing bad triaging and/or fixes. Most loggers are not protected." />

<meta property="keywords"
  content='c, forging, java, json, libraries, library, log, manipulation, net, node, open-souce, rails, ruby, viewer, vulnerability, web' />

<meta name="author" content="Luis Fontes">




<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "articleSection": "posts",
    "name": "The Log Forging Vulnerability And How To Fix It",
    "headline": "The Log Forging Vulnerability And How To Fix It",
    "alternativeHeadline": "",
    "description": "Log forging vulnerability can be exploited to fake log entries, causing bad triaging and\/or fixes. Most loggers are not protected.",
    "inLanguage": "en-us",
    "isFamilyFriendly": "true",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https:\/\/thesecurityvault.com\/the-log-forging-vulnerability-and-how-to-fix-it\/"
    },
    "author" : {
        "@type": "Person",
        "name": "map[avatar:\/img\/luisfontes19.jpeg bio:After 5 years working with different technologies as full stack developer I changed to the AppSec world. Worked at checkmarx and huge global customers reviewing application\u0027s source code to find and help mitigate its vulnerabilities. From there changed to IOVLabs (RSK) and the crypto currency world. Nowadays I work at a Xapo, a crypto bank. jobTitle:Application Security Engineer | eMAPT | eWPTXv2 name:Luís Fontes username:luisfontes19]"
    },
    "creator" : {
        "@type": "Person",
        "name": "map[avatar:\/img\/luisfontes19.jpeg bio:After 5 years working with different technologies as full stack developer I changed to the AppSec world. Worked at checkmarx and huge global customers reviewing application\u0027s source code to find and help mitigate its vulnerabilities. From there changed to IOVLabs (RSK) and the crypto currency world. Nowadays I work at a Xapo, a crypto bank. jobTitle:Application Security Engineer | eMAPT | eWPTXv2 name:Luís Fontes username:luisfontes19]"
    },
    "accountablePerson" : {
        "@type": "Person",
        "name": "map[avatar:\/img\/luisfontes19.jpeg bio:After 5 years working with different technologies as full stack developer I changed to the AppSec world. Worked at checkmarx and huge global customers reviewing application\u0027s source code to find and help mitigate its vulnerabilities. From there changed to IOVLabs (RSK) and the crypto currency world. Nowadays I work at a Xapo, a crypto bank. jobTitle:Application Security Engineer | eMAPT | eWPTXv2 name:Luís Fontes username:luisfontes19]"
    },
    "copyrightHolder" : "The Security Vault",
    "copyrightYear" : "2021",
    "dateCreated": "2021-01-10T00:00:00.00Z",
    "datePublished": "2021-01-10T00:00:00.00Z",
    "dateModified": "2022-02-20T13:42:27.31Z",
    "publisher":{
        "@type":"Organization",
        "name": "The Security Vault",
        "url": "https://thesecurityvault.com",
        "logo": {
            "@type": "ImageObject",
            "url": "https:\/\/thesecurityvault.com\/img\/logo.png",
            "width":"32",
            "height":"32"
        }
    },
    "image": "https://thesecurityvault.com/img/logo.png",
    "url" : "https:\/\/thesecurityvault.com\/the-log-forging-vulnerability-and-how-to-fix-it\/",
    "wordCount" : "1268",
    "genre" : [ "c" , "forging" , "java" , "json" , "libraries" , "library" , "log" , "manipulation" , "net" , "node" , "open-souce" , "rails" , "ruby" , "viewer" , "vulnerability" , "web" ],
    "keywords" : [ "c" , "forging" , "java" , "json" , "libraries" , "library" , "log" , "manipulation" , "net" , "node" , "open-souce" , "rails" , "ruby" , "viewer" , "vulnerability" , "web" ],
}
</script>



<meta property="og:title" content="The Log Forging Vulnerability And How To Fix It" />
<meta property="og:description"
  content="Log forging vulnerability can be exploited to fake log entries, causing bad triaging and/or fixes. Most loggers are not protected." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://thesecurityvault.com/the-log-forging-vulnerability-and-how-to-fix-it/" /><meta property="og:image" content="https://thesecurityvault.com/the-log-forging-vulnerability-and-how-to-fix-it/images/banner.png" /><meta property="article:section" content="posts" />

<meta property="article:published_time" content="2021-01-10T00:00:00+00:00" />

<meta property="article:modified_time" content="2022-02-20T13:42:27+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://thesecurityvault.comimages/banner.png" /><meta name="twitter:title" content="The Log Forging Vulnerability And How To Fix It" />
<meta name="twitter:description"
  content="Log forging vulnerability can be exploited to fake log entries, causing bad triaging and/or fixes. Most loggers are not protected." />


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@700&family=Roboto:ital,wght@1,900&display=swap"
  rel="stylesheet">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/fontawesome.min.css"
  integrity="sha384-jLKHWM3JRmfMU0A5x5AkjWkw/EYfGUAGagvnfryNV3F9VqM98XiIH7VBGVoxVSc7" crossorigin="anonymous">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
  integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
<link rel="stylesheet" href="https://thesecurityvault.com/css/styles.ee9e2ce8a02b41443541de90c22fcdd19ee882b9c1f66a530f6f4c5a9cb4ec197d5201fc03be68d0b6175646ab63c9ae99c47a42181b7368145b69c9f2ba75a7.css">



<script>
  console.log("Hmm wait, what?!")
  console.log("77 90 26 59 64 81 81 84 12 89 12 82 80 43 83");
  console.log("14 6  8  10 1  3  12 2  4  11 9  2  7  5  13");
  console.log("Should add 20")
</script></head>

<body><section id="header" class="header-alt"></section>
<section class="container-fluid menu-container">
  <div>
    <nav id="navbar" class="navbar navbar-expand-lg navbar-default sticky" style="z-index:10;">
      <a class="navbarbar-brand" href="/">
        <img src="https://thesecurityvault.com/img/logo.png">
      </a>
      <div style="height:50px;"></div>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#menubar" aria-controls="menubar"
        aria-expanded="false" aria-label="">
        <span class="navbar-toggler-icon">
          <i class="fa fa-bars"></i>
        </span>
      </button>


      <div class="collapse navbar-collapse" id="menubar">
        <div class="navbar-nav mr-auto"></div>

        <ul class="navbar-nav">
          
          <li class="nav-item">
            <a class="nav-link" href="/">
              Home
            </a>
          </li>
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">
              About me
            </a>
          </li>
          
        </ul>

      </div>

    </nav>
  </div>
</section>


<div class="container">
  <div class="page">
    <section class="single-post">

      <img class="single-post-image" src="https://thesecurityvault.com/the-log-forging-vulnerability-and-how-to-fix-it/images/banner.png" />
      <div class="">
        <div class="single-post-header text-center">
          <h1>The Log Forging Vulnerability And How To Fix It</h1>
          <div class="single-post-details text-secondary">
            <ul>
              <li><a href="">luisfontes19</a></li>
              <li>Jan 10, 2021</li>
              <li class="text-secondary">6 minutes</li>
              
              <li>appsec</li>
            </ul>
          </div>
        </div>

        <div class="single-post-content">
          <p>The Log Forging vulnerability, also known as Log Manipulation is a really low ranked vulnerability that in a lot of cases its to farfetched to be reliably exploited, but on others can be quite easy and cause real damage.</p>
<p>In this post we&rsquo;ll understand what is log forging and see many different conditions that can cause the vulnerability or to increase the risk.</p>
<h2 id="what-is-log-forging">What is Log Forging</h2>
<p>Log forging is a vulnerability where an attacker can manipulate the logs, by creating new entries. This usually happens because user input gets directly to the logs without any sanitisation.</p>
<p>Most traditional log format is a plain text file, where each line is a new entry in the log. If an attacker sends some content with a new line character it can create a new log entry.</p>
<p>Example:</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2">2</a>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="3"><a style="outline: none; text-decoration:none; color:inherit" href="#3">3</a>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="4"><a style="outline: none; text-decoration:none; color:inherit" href="#4">4</a>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="5"><a style="outline: none; text-decoration:none; color:inherit" href="#5">5</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">starting webserver
received request from 192.168.1.1
received username: thesecurityvault
received request from 192.168.1.2
sending ok message
</code></pre></td></tr></table>
</div>
</div><p>In red is the content received from user input. Since it wasn&rsquo;t properly handled, the user introduced a new line and then faked a new log entry.</p>
<p>In this case it could mean that the request to 192.168.1.1 failed somewhere, and that a request to 192.168.1.2 was properly done.</p>
<h2 id="not-that-easy-to-fake">Not that easy to fake</h2>
<p>If you look to the example above, to actually fake the behaviour of the log, the attacker needed to know how to log outputs messages, otherwise it won&rsquo;t be that reliable.</p>
<p>Lets see other example of logs:</p>
<p>Wordpress error log:</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2">2</a>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="3"><a style="outline: none; text-decoration:none; color:inherit" href="#3">3</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">[15-Jun-2018 17:24:03 UTC] PHP Warning:  Use of undefined constant theme_section - ....
[15-Jun-2018 17:24:31 UTC] PHP Warning:  Use of undefined constant theme_section ...
[20-May-2018 20:39:14 UTC] WordPress database error Table &#39;xyz&#39; doesn&#39;t exist
</code></pre></td></tr></table>
</div>
</div><p>Checkmarx&rsquo;s scan log:</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2">2</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">08/03/2018 11:41:54,726 [MainThread_CxEng] INFO Available memory: 9790 Used memory: 307 Elapsed Time: 00:00:07.4013541 [Unspecified] - No Unified languages configured
08/03/2018 11:41:54,776 [MainThread_CxEng] INFO Available memory: 9650 Used memory: 308 Elapsed Time: 00:00:07.4511596 [Unspecified] - Scanning or Auditing Project type code is ...
</code></pre></td></tr></table>
</div>
</div><p>As you can see in both cases, applications tend to prepend some content to the log message, but the format is not the same for all applications so for an attacker to successfully do a log forging attack it would need to know the format of the prepended data.</p>
<p>An attacker can also count with an &ldquo;uneducated&rdquo; user looking at the logs, or hope it wont notice the wrong data.</p>
<h2 id="increased-risk-for-open-source-or-on-prem-projects">Increased risk for open source or on prem projects</h2>
<p>If you have an application vulnerable to log forging (and almost all applications I reviewed professionally were) and open source the risk increases significantly because an attacker can study the code and see where user input ends up in the logs and the proper log format.</p>
<p>The risk also increases with proprietary software where you have access to logs, like on prem installations, as an attacker can see the log format and can also test locally for vulnerable entry points, then exploit them on other systems.</p>
<h2 id="variants">Variants</h2>
<h3 id="json">JSON</h3>
<p>Sometimes applications use JSON formatted logs. In this case the new line may not be that relevant as everything inside the string content is part of the log.</p>
<p>But there are other issues to take into account here. First, if the logs still uses one line per entry, an attacker can try to trick the victim, the same way, by creating new lines.</p>
<p>This is easily spotted by an experienced user, that can see that the string content didn&rsquo;t end on the line break.</p>
<p>On the other hand if the JSON log is prepared just by concatenating strings, this can still be an issue.</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#000">console</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">log</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">`{&#34;Severity&#34;: &#34;INFO&#34;, message: &#34;bad username: </span><span style="color:#4e9a06">${</span><span style="color:#000">username</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;}`</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></td></tr></table>
</div>
</div><p>In the example above (in javascript), although the log is in JSON format, it was done by just concatenating some user input into a string and an attacker, can escape the string content and create new log entries (attacker input in red):</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2">2</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">&#34;Severity&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;INFO&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">message:</span> <span style="color:#204a87;font-weight:bold">&#34;bad username: &#34;</span><span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">{</span> <span style="color:#204a87;font-weight:bold">&#34;Severity&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;INFO&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#a40000">message:</span> <span style="color:#204a87;font-weight:bold">&#34;DUMPING USER CREDENTIALS &#34;</span> <span style="color:#000;font-weight:bold">}</span>
</code></pre></td></tr></table>
</div>
</div><p>To mitigate this attack, in javascript, work with regular JS Objects and at the end use JSON.stringify to convert the object into well formatted javascript. This will prevent the issue.</p>
<h3 id="log-viewer">Log Viewer</h3>
<p>Another exploitable scenario may be the log viewer itself, instead of the log. If an application uses a tool to visualize the logs, you can trick the tool to display the log like it was a new entry.</p>
<p>Lets say you created your own log viewer, that parses each line of the log as an entry, and you removed all new lines from user input so that no new lines could be maliciously created.</p>
<p>And when you write the log entries to the webpage, you use something like:</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#ce5c00;font-weight:bold">&lt;?</span><span style="color:#000">php</span> <span style="color:#204a87;font-weight:bold">echo</span> <span style="color:#000">$logentry</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#8f5902;font-style:italic">?&gt;</span><span style="color:#a40000">
</span></code></pre></td></tr></table>
</div>
</div><p>This can still cause an issue, as an attacker can inject an html new line (<!-- raw HTML omitted -->) that will be interpreted by the browser. If you just create a new div for each log entry, an attacker could close that div and open a new one.</p>
<p>Here a log forging vulnerability wouldn&rsquo;t be the major concern, as XSS attacks would be possible through the log input.</p>
<h2 id="logging-libraries">Logging libraries</h2>
<p>From what I&rsquo;ve seen so far, most log libraries do not have default mechanisms to prevent log forging, although they allow you to create a custom formatter to replace the new lines.</p>
<p>Let&rsquo;s see some examples</p>
<h3 id="java">Java</h3>
<p><strong>Log4j</strong> have built-in mechanisms to help prevent log forging. Unfortunately is up to the developer to specify them. And if you&rsquo;re a developer looking in google how to use these libraries, nobody tell you to use it&hellip;</p>
<p>When configuring the log pattern in the log config file there&rsquo;s a placeholder called encode that can be used to automatically encode new lines:</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-INI" data-lang="INI"><span style="color:#c4a000">log4j.appender.stdout.layout.ConversionPattern</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">%encode{%m}%n</span>
</code></pre></td></tr></table>
</div>
</div><p>SLF4J</p>
<p><strong>SLF4J</strong> doens&rsquo;t have a default protection but, you can create a custom conversion rule to sanitise new lines, and configure the log pattern with that rule.</p>
<h3 id="c">C#</h3>
<p><strong>Log4net</strong> doesn&rsquo;t have a default protection either, but as slf4j you can create a custom pattern convertor to replace new lines. You can read more about it <a href="https://dejanfajfar.wordpress.com/2011/04/14/log4net-custom-layoutpattern/">here</a>.</p>
<h3 id="node">Node</h3>
<p>In node, with <strong>Winston</strong>, if you go with the JSON format it is safely serialised. But if you chose to use the simple format (one line per entry), you don&rsquo;t have a built in way to protect log forging, but you can create a custom format rule.</p>
<h3 id="rails">Rails</h3>
<p>For rails, the default library doesn&rsquo;t offer any protection either. In the same way as in the other scenarios a custom formatter can be created to sanitise the user input:</p>
<div class="highlight"><div style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2">2</a>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="3"><a style="outline: none; text-decoration:none; color:inherit" href="#3">3</a>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="4"><a style="outline: none; text-decoration:none; color:inherit" href="#4">4</a>
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="5"><a style="outline: none; text-decoration:none; color:inherit" href="#5">5</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">SafeFormatter</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Logger</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Formatter</span>
  <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">call</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">severity</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">timestamp</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">progname</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">msg</span><span style="color:#000;font-weight:bold">)</span>
    <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">#{</span><span style="color:#000">msg</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">gsub</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">/\n/</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">\\</span><span style="color:#4e9a06">n&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span>
  <span style="color:#204a87;font-weight:bold">end</span>
<span style="color:#204a87;font-weight:bold">end</span>
</code></pre></td></tr></table>
</div>
</div><p>Then set the formatter as the log formatter in &ldquo;config.log_formatter&rdquo; property in config/environment/*</p>
<h3 id="go">Go</h3>
<p>And for go, <strong>logrus</strong> was actually the only logger that I tested so far that by default sanitised new lines, no config needed, nothing. Kudos.</p>
<p>I&rsquo;m not a Go dev so I didn&rsquo;t test it a lot, but being safe by default is a huge win IMO.</p>
<h2 id="tldr">TL;DR</h2>
<ul>
<li>Attackers can fake log entries, leading to bad triages or fixes</li>
<li>Log forging is hard to exploit if you don&rsquo;t know the format of the log
<ul>
<li>Bigger issue for open source and on prom software</li>
<li>Less relevant for closed source online services (completely blind attacks)</li>
</ul>
</li>
<li>Log viewers can also be leveraged to exploit the vulnerability, and worst case scenario cause XSS</li>
<li>JSON formatted logs have a different attack vector</li>
<li>Usually loggers are unsafe and is up to the developer to create a protection</li>
<li>Protections can usually be done by custom formatters</li>
</ul>


          
        </div>
      </div>

      <div class="challange1">
        <div class="d-none  d-sm-none d-md-block">
          ClZHaGxVMlZqZFhKcGRIbFdZWFZzZEVobGNrWnZjbGx2ZFZSb1pWTmxZM1ZwZEhsV1lYVnNkRWhsY21WR2IzSlpiM1ZVYUdWVFkzVnlhWFI1Vm1GMWJIUklaWEpsUm05eVdXOTFWR2hsVTJWamRYSnBkSGxXWVhWc2RFaGxaVVp2Y2xsdmRWUm9aVk5qZFhKcGRIbFdZWFZzZEVobGNtVkdiM0paYjNWVWFGTmxZM1Z5YVhSNVZtRjFiSFJJWlhKbFJtOXlXVzkxVkdobFUyVmpkWEpwZEhsV1lYVnNkRWhsY21WdmNsbHZkVlJvWlZObFkzVnlhWFI1Vm1GMWJIUkljbVZHYjNKWmIzVlVhR1ZUWldOMWNuUjVWbUYxYkhSSVpYSmxSbTl5V1c5MVZHaGxVMlZqZFhKcGRIbFdZWFZzZEVobGNrWnZjbGx2ZFZSb1pWTmxZM1Z5YVhSNVZtRjFiSFJJWlhKbFJtOXlXWFZVYUdWVFpXTjFjbWwwZVZaaGRXeDBTR1Z5WlVaeVdXOTFhR1ZUWldOMWNtbDBlVlpoZFd4MFNHVnlaVVp2Y2xsdmRWUm9aVk5sWTNWeWFYUjVWbUYxYkhSSVpYSmxiM0paYjNWVWFHVlRaV04xY21sMGVXRjFiSFJJWlhKbFJtOXlXVzkxVkdobFUyVmpkWEpwZEhsV1lYVnNkRWhsY2tadmNsbHZkUT09
        </div>
      </div>
    </section>



  </div>

  <div class="single-post-pagination">
    <div class="row post-pagination">
      <div class="col-md-6 previous-post">
        
        <a href="https://thesecurityvault.com/screen-caching/">&lArr; Previous Post<br><b>Screen Caching</b></a>
        
      </div>
      <div class="col-md-6 next-post">
        
        <a href="https://thesecurityvault.com/are-your-mobile-banking-apps-secure/"> Next Post &rArr;<br><b>Are your mobile banking apps secure?</b></a>
        
      </div>
    </div>
  </div>
</div><footer class="text-center footer">

  <div class="container footer-content">
    <div class="row">

      <div class="col-md-6 text-left">
        <div><img src="https://thesecurityvault.com/img/logo.png"></div>
      </div>

      <div class="col-md-6 text-right">
        <div>
          <a href="/sitemap.xml">Sitemap</a>
        </div>
        <div>
          Copyright 2019-2022 The Security Vault. All rights reserved.
        </div>
      </div>
    </div>

</footer>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
  integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
<script src="https://kit.fontawesome.com/ab4860f980.js"
  integrity="sha384-AbZOA7GYMJh1wZbW0vLI9LLjXjJcIago4vs45qRTQmAlaelCTcLcXNn1dpEmI2Jo" crossorigin="anonymous"></script>

<script>

  
  const links = document.getElementsByTagName("a")
  for (let i = 0; i < links.length; i++) {
    const link = links[i]
    link.addEventListener("click", (evt) => {
      const a = evt.currentTarget
      const isImage = a.href.endsWith(".jpg") || a.href.endsWith(".png") || a.href.endsWith(".jpeg") || a.href.endsWith(".gif")
      const external = a.href.startsWith("http" && !a.href.startsWith(window.location.origin))

      if (isImage || external) {
        evt.currentTarget.target = "_blank"
        evt.currentTarget.rel = "noopener noreferrer"
      }
    })
  }


  
  const headers = document.querySelectorAll(".single-post-content > h2,.single-post-content > h3,.single-post-content > h4,.single-post-content > h5,.single-post-content > h6")
  const icon = document.createElement("i")
  icon.className = "fas fa-link"
  icon.textContent = " "
  icon.style.marginLeft = "5px"
  icon.style.fontSize = "20px"

  for (let i = 0; i < headers.length; i++) {
    const h = headers[i]
    h.insertAdjacentElement("beforeend", icon.cloneNode())
    h.onclick = () => window.location.hash = h.id

  }

</script></body>

</html>